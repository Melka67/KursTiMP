/**
 * @file processor.h
 * @brief Заголовочный файл класса обработки векторных данных
 * @author Мелькаев Евгений
 * @date 2025
 */

#ifndef PROCESSOR_H
#define PROCESSOR_H

#include <vector>

/**
 * @brief Класс для обработки векторных данных от клиентов
 * 
 * Вычисляет произведение элементов векторов с обработкой переполнения.
 * Работает с данными, полученными по сети от аутентифицированных клиентов.
 */
class Processor {
public:
    /**
     * @brief Обрабатывает векторные данные от клиента
     * @param clientSocket Дескриптор сокета клиента
     * @return true Обработка завершена успешно
     * @return false Ошибка при обработке
     * 
     * @details Протокол обмена:
     * 1. Получает количество векторов (uint32_t)
     * 2. Для каждого вектора:
     *    - Получает размер (uint32_t)
     *    - Получает данные вектора (double[])
     *    - Вычисляет произведение элементов
     *    - Отправляет результат обратно
     */
    static bool processVectors(int clientSocket);
    
// Делаем методы публичными для тестов
#ifdef UNIT_TESTS
public:
#else
private:
#endif
    /**
     * @brief Вычисляет произведение элементов вектора
     * @param vector Вектор чисел с плавающей точкой
     * @return double Результат умножения всех элементов
     * 
     * @details Особенности обработки:
     * - Если вектор пуст - возвращает 0.0
     * - Если встречается 0.0 - сразу возвращает 0.0
     * - Отслеживает знак произведения
     * - При переполнении double возвращает граничные значения
     *   (2^63-1 для положительных, -2^63 для отрицательных)
     */
    static double calculateProduct(const std::vector<double>& vector);
};

#endif